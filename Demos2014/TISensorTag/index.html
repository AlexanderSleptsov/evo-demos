<!DOCTYPE html>
<!--
	Demonstration of the TI SensorTag JavaScript library.
-->
<html>
<head>
	<meta charset="utf-8" />
	<meta name="format-detection" content="telephone=no" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>TI SensorTag Demo</title>
	<link rel="stylesheet" href="common.css" />
	<style>
	body {
		background: rgb(255,255,255);
	}
	.SensorData {
		font-size: 22px;
	}
	</style>
	<script>
	// Redirect console.log to Evothings Workbench.
	if (window.hyper) { console.log = hyper.log; }
	</script>
	<script src="cordova.js"></script>
	<script src="easy-ble.js"></script>
	<script src="ti-sensortag.js"></script>
</head>
<body>
	<h1>TI SensorTag</h1>

	<div class="SensorData" id="IRTemperatureData">IRTemperature:<br/>[Waiting for value]</div>
	<div class="SensorData" id="AccelerometerData">Accelerometer:<br/>[Waiting for value]</div>
	<div class="SensorData" id="HumidityData">Humidity:<br/>[Waiting for value]</div>
	<div class="SensorData" id="MagnetometerData">Magnetometer:<br/>[Waiting for value]</div>
	<div class="SensorData" id="BarometerData">Barometer:<br/>[Waiting for value]</div>
	<div class="SensorData" id="GyroscopeData">Gyroscope:<br/>[Waiting for value]</div>
	<div class="SensorData" id="KeypressData">Keypress:<br/>[Waiting for value]</div>

	<script>
	function initialiseSensortag()
	{
		var sensorTag = TISensorTag.createInstance()
		sensorTag
			.irTemperatureCallback(irTemperatureHandler)
			.humidityCallback(humidityHandler)
			.barometerCallback(barometerHandler)
			.accelerometerCallback(accelerometerHandler, 100)
			.magnetometerCallback(magnetometerHandler, 100)
			.gyroscopeCallback(gyroscopeHandler, 100)
			.keypressCallback(keypressHandler)
			.connectToClosestDevice()
	}

	function irTemperatureHandler(data)
	{
		displaySensorValue(
			'IRTemperatureData',
			'IRTemperature',
			data[0] + ',' + data[1] + ',' + data[2] + ',' + data[3])
	}

	function accelerometerHandler(data)
	{
		//console.log('length: ' + data.length)
		//console.log('acceldata: ' + data[0] + ' ' + data[1] + ' ' + data[2])

		displaySensorValue(
			'AccelerometerData',
			'Accelerometer',
			data[0] + ',' + data[1] + ',' + data[2])
	}

	function humidityHandler(data)
	{
		displaySensorValue(
			'HumidityData',
			'Humidity',
			data[0] + ',' + data[1] + ',' + data[2] + ',' + data[3])
	}

	function magnetometerHandler(data)
	{
		displaySensorValue(
			'MagnetometerData',
			'Magnetometer',
			data[0] + ',' + data[1] + ',' + data[2])
	}

	function barometerHandler(data)
	{
		displaySensorValue(
			'BarometerData',
			'Barometer',
			data[0] + ',' + data[1] + ',' + data[2] + ',' + data[3])
	}

	function gyroscopeHandler(data)
	{
		displaySensorValue(
			'GyroscopeData',
			'Gyroscope',
			data[0] + ',' + data[1] + ',' + data[2] + ','
			+ data[3] + ',' + data[4] + ',' + data[5])
	}

	function keypressHandler(data)
	{
		displaySensorValue(
			'KeypressData',
			'Keypress',
			data[0])
	}

	function displaySensorValue(elementId, label, value)
	{
		document.getElementById(elementId).innerHTML = label + ':<br/>' + value
	}

	document.addEventListener('deviceready', initialiseSensortag, false)
	</script>
</body>
</html>
